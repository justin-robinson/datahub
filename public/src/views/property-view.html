<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-autocomplete/paper-autocomplete.html">
<link rel="import" href="../behaviors/api-resource-behaivor.html">

<dom-module id="property-view">

    <template>
        <style>

            :host {
                display: block;
            }

            paper-card paper-input,paper-autocomplete {
                width: 95%;
                padding-left:1em;
            }

            paper-card {
                width: 100%;
            }
            paper-icon-button.save {
                color: var(--paper-light-green-500);
            }
            paper-icon-button.save:hover {
                background-color: var(--paper-light-green-500);
                color: var(--paper-grey-200);
            }

            paper-icon-button.delete {
                float:right;
                color: var(--paper-red-a200);
            }
            paper-icon-button.delete:hover {
                background-color: var(--paper-red-a200);
                color: var(--paper-grey-200);
            }

        </style>

        <paper-card heading="{{data.name}}">
            <div>
                <paper-input value="{{sortedProperties.address1.value}}" label="Address 1"></paper-input>
                <paper-input value="{{sortedProperties.address2.value}}" label="Address 2"></paper-input>
            </div>
            <paper-icon-button id="save" icon="save" on-click="saveResource" class="save">Save</paper-icon-button>

            <template is="dom-if" if="{{data.companyInstancePropertyId}}">
                <paper-icon-button id="delete" icon="delete" on-click="confirmDelete" class="delete"></paper-icon-button>
            </template>
        </paper-card>

        <confirm-delete-view id="confirmDelete" on-yes="deleteResource">
            Are you sure you want to delete this company and its instances?
        </confirm-delete-view>

    </template>

    <script>
        (function () {

            Polymer({
                is: 'property-view',
                behaviors: [
                    Datahub.ApiResourceBehavior
                ],
                properties: {
                    idField:               {
                        value:'companyInstancePropertyId'
                    },
                    url:                   {
                        value: Datahub.apiUrl + 'property'
                    },
                    removeFromDomOnDelete: {
                        value: true
                    },
                    props:                 {
                        type: Array,
                        value: function () { return []; },
                        notify: true
                    },
                    sortedProperties: {
                        type: Object,
                        value: function() { return {}; }
                    }
                },
                ready: function () {
                    this.listen(this, 'props-changed', 'sortProperties');
                },
                sortProperties: function () {
                    var sortedProperties = {};
                    var property;
                    // get the latest property of each name
                    for ( var i=0; i<this.props.length; ++i) {
                        property = this.props[i];
                        if ( !sortedProperties[property.name] || property.updatedAt.localeCompare(sortedProperties[property.name].updatedAt) === 1) {
                            sortedProperties[property.name] = property;
                        }
                    }
                    this.set('sortedProperties', sortedProperties)
                },
                confirmDelete: function () {
                    this.$.confirmDelete.open();
                }
            });
        })();
    </script>

</dom-module>
